const game = {
    "yazi": "yazÄ±",
    "tura": "tura"
}

const players = [];

room.onPlayerJoin = (player) => {
    const kayitliOyuncu = players.find((o) => o.auth === player.auth);

    if (kayitliOyuncu) {
        kayitliOyuncu.id = player.id;
        kayitliOyuncu.name = player.name;
    } else {
        players.push({
            "id": player.id,
            "name": player.name,
            "auth": player.auth,
            "bakiye": 100 // Set an initial balance, adjust as needed
        });
    }
    console.log(players);
};

room.onPlayerChat = (player, message) => {
    const args = message.split(' ');

    if (args[0] === '!game' && args.length === 3 && (args[1].toLowerCase() === 'yazi' || args[1].toLowerCase() === 'tura')) {
        // Correctly formatted !game command
        const chosenGame = args[1].toLowerCase();
        const betAmount = parseInt(args[2]);

        const currentPlayer = players.find((p) => p.id === player.id);

        if (!isNaN(betAmount) && betAmount > 0 && betAmount <= currentPlayer.bakiye) {
            const result = Math.random() < 0.5 ? game.yazi : game.tura;

            room.sendAnnouncement(`ğŸ² ${player.name}, bahisiniz alÄ±ndÄ±. Bekleyin...`, null, 0x00FF00, 'bold');

            setTimeout(() => {
                if (chosenGame === result.toLowerCase()) {
                    currentPlayer.bakiye += betAmount;
                    room.sendAnnouncement(`ğŸ‰ ${player.name} ${chosenGame} iÃ§in ${betAmount} miktarÄ±nda bahis yaptÄ± ve kazandÄ±! Yeni bakiye: ${currentPlayer.bakiye} ğŸ’°`, null, 0x00FF00, 'bold');
                } else {
                    currentPlayer.bakiye -= betAmount;
                    room.sendAnnouncement(`ğŸ˜¢ ${player.name} ${chosenGame} iÃ§in ${betAmount} miktarÄ±nda bahis yaptÄ± ve kaybetti. Yeni bakiye: ${currentPlayer.bakiye} ğŸ’¸`, null, 0xFF0000, 'bold');
                }
            }, 3000);
            return false;
        } else {
            room.sendAnnouncement(`âŒ GeÃ§ersiz bahis! Bahis miktarÄ± geÃ§erli bir pozitif sayÄ± olmalÄ± ve bakiyenizden bÃ¼yÃ¼k olamaz.`, player.id, 0xFF0000, 'bold');
            return false;
        }
    } else if (args[0] === '!game') {
        // Incorrectly formatted !game command
        room.sendAnnouncement("â“ Bahis oynamak iÃ§in: !game [yazi/Tura] [BahisMiktarÄ±]", player.id, 0x00FF00, 'bold');
        return false;
    } else if (args[0] === '!bakiye') {
        // !bakiye command to check own balance
        const currentPlayer = players.find((p) => p.id === player.id);
        if (currentPlayer) {
            room.sendAnnouncement(`ğŸ’° ${player.name}, bakiyeniz: ${currentPlayer.bakiye}`, player.id, 0x00FF00, 'bold');
            return false;
        }
    } else if (args[0] === '!game-top') {
        // !game-top command to display ranking
        const ranking = players.sort((a, b) => b.bakiye - a.bakiye);
        const currentPlayerIndex = ranking.findIndex((p) => p.id === player.id);
        room.sendAnnouncement(`ğŸ† ${player.name}, sÄ±ralama: ${currentPlayerIndex + 1}/${ranking.length}`, player.id, 0x00FF00, 'bold');
        return false;
    }
};
